"use strict";angular.module("mobbr.controllers").controller("LightboxController",["$scope","$location","$timeout","Gateway","Url","userSession","User","Balances",function(a,b,c,d,e,f,g,h){function i(){n=b.search().error,m=b.search().hash,o=b.search().login,p=b.search().logout,a.loginerror=!1,n?(a.dologin=!1,a.loading=!1,a.errormessage=n,a.marked=!1):m?(a.dologin=!1,d.analyzePayment({data:window.atob(m),referrer:document.referrer},function(b){m=b.result,e.fullData({hash:m},function(b){a.urlData=b.result,a.noscript=void 0===a.urlData.meta_data[".scripts_found"]||0===a.urlData.meta_data[".scripts_found"].length,a.noparticipants=void 0===a.urlData.meta_data.participants||0===a.urlData.meta_data.participants.length,a.loading=!1})})):o?(a.dologin=!0,a.loading=!1):p?f.doLogout(!0):(a.dologin=!1,a.loading=!0,a.marked=void 0,a.json=void 0,a.noscript=void 0),j()}function j(){f.authenticated?h.balance(function(b){a.userCurrencies=b.result,a.currency=a.userCurrencies[0]}):a.currency="EUR"}function k(){d.registerPayment({referrer:document.referrer||"http://zaplog.nl",hash:m},function(){a.marked=!0,a.laterpaying=void 0,a.laterpayed=!0,a.nowpayed=void 0},function(b){a.errormessage=b.data&&b.data.message&&b.data.message.text,a.marked=!1,a.laterpaying=void 0})}function l(){var b=a.currency&&a.currency.currency_iso||a.currency;d.performPayment({referrer:document.referrer||"http://zaplog.nl",currency:b,amount:a.amount,hash:m},function(){a.marked=!0,a.nowpaying=void 0,a.nowpayed=!0,a.laterpayed=void 0},function(b){a.customerror=b.data.message.text,a.nowpaying=void 0,c.cancel(q),r=c(function(){a.customerror=void 0},5e3)})}var m,n,o,p,q,r;a.$on("$locationChangeSuccess",i),a.registerPayment=function(b){a.laterpaying=!0,f.authenticated?k():a.login(b,!1,!0)},a.performPayment=function(b){a.nowpaying=!0,f.authenticated?l():a.login(b,!1,!1,!0)},a.login=function(b,c,d,e){g.login({email:b.email.$modelValue,password:b.password.$modelValue},function(a){void 0!=a.result&&null!=a.result&&(f.doLogin(a.result,c),d&&k(),e&&l(),j())},function(){a.loginerror=!0,a.laterpaying=void 0,a.nowpaying=void 0})},a.currency=f.currency_iso,a.loading=!0,a.userSession=f}]),angular.module("mobbr.controllers",[]),angular.module("mobbr.directives",[]),angular.module("mobbr.filters",[]),angular.module("mobbr-lightbox",["ui.bootstrap","mobbr.directives","mobbr.controllers","mobbr.services.msg","mobbr.services.mbr-api","mobbr.services.storage","mobbr.services.user","mobbr.filters"]).run(["$http","$rootScope","Util","$location","userSession","Msg","$window","$anchorScroll","$routeParams",function(a,b,c){b.currenciesMap={},c.currencies(function(a){null!=a.result?b.currenciesMap=a.result:null!=a.message&&console.log("error loading currencies"+a.error.status),b.currenciesMap.MBR="Mobbr"})}]);