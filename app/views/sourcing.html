<div class="alert alert-info" ng-hide="userSession.authenticated">
    The source board is empty because you are not logged in. To login or signup, go <a href="#/join">here</a>.
</div>
<tabs>
    <pane heading="Pledges">
        <div class="row-fluid">
            <div class="well span12 special">
                <small>Tasks to which you pledged or paid.</small>
            </div>
        </div>

        <form class="form-inline clearfix">
            <fieldset class="pull-left">
                <button class="btn btn-danger" ng-click="deletePayments(selectedPledges)" ng-disabled="numSelected(selectedPledges) < 1">Remove pledges</button>
            </fieldset>
        </form>

        <table ng-table="pledgesTable" class="mobbrtable table table-striped table-checkbox">
            <tbody ng-repeat="group in $groups">
            <tr class="ng-table-group">
                <td colspan="{{ $columns.length }}">
                    <div ng-click="group.$hideRows = !group.$hideRows">
                        <span ng-class="{ 'icon-chevron-right': group.$hideRows, 'icon-chevron-down': !group.$hideRows }"></span>
                        <span ng-bind="group.value"></span>
                    </div>
                </td>
            </tr>
            <tr ng-hide="group.$hideRows" ng-repeat="pledge in group.data" title="{{ user.title }}">
                <td>
                    <input type="checkbox" ng-model="selectedPledges[pledge.id]" />
                </td>
                <td sortable="url" data-title="'Task'">
                    <div ng-bind="pledge.title"></div>
                    <!--<a ng-click="openUrl(pledge.url)"><small ng-bind="pledge.url"></small></a>-->
                </td>
                <td sortable="currency" data-title="'Currency'" ng-bind="userSession.user.currency_iso" class="currency"></td>
                <td sortable="amount" data-title="'Amount'" class="amount">
                            <span ng-bind="pledge.amount | mobbrcurrency"
                                  ng-class="{ 'text-error': pledge.amount < 0 }"
                                  class="nowrap"></span>
                </td>
            </tr>
            </tbody>
        </table>
        <script type="text/ng-template" id="ng-table/headers/checkbox.html">
            <input type="checkbox" ng-model="checkboxes.checked" id="select_all" name="filter-checkbox" value="" />
        </script>

        <table ng-table="tasksTable" class="mobbrtable table table-striped table-checkbox">
            <tbody ng-repeat="group in $groups">
            <tr class="ng-table-group">
                <td colspan="{{ $columns.length }}">
                    <div ng-click="group.$hideRows = !group.$hideRows">
                        <span ng-class="{ 'icon-chevron-right': group.$hideRows, 'icon-chevron-down': !group.$hideRows }"></span>
                        <span ng-bind="group.value"></span>
                        <!--<div><a ng-click="openUrl(group.data[0].url)"><small ng-bind="group.data[0].url"></small></a></div>-->
                    </div>
                </td>
            </tr>
            <tr ng-hide="group.$hideRows" ng-repeat="task in group.data" title="{{ user.title }}">
                <td data-title="''">
                    <img ng-src="https://secure.gravatar.com/avatar/{{ task['gravatar'] }}?s=20&default=https://mobbr.com/img/default-gravatar.png"
                         class="gravatar small img-rounded"
                         width="20"
                         height="20">
                </td>
                <td sortable="username" data-title="'Username'" ng-bind="task.username"></td>
                <td sortable="datetime" data-title="'Date'"><small ng-bind="task.datetime"></small></td>
                <td sortable="roles" data-title="'Role'" ng-bind="task.roles" class="roles"></td>
                <td sortable="currency" data-title="'Currency'" ng-bind="userSession.user.currency_iso" class="currency"></td>
                <td sortable="amount" data-title="'Amount'" class="amount">
                            <span ng-bind="task.amount | mobbrcurrency"
                                  ng-class="{ 'text-error': task.amount < 0 }"
                                  class="nowrap"></span>
                </td>
            </tr>
            </tbody>
        </table>
    </pane>
    <pane heading="Workers">
        <div class="row-fluid">
            <div class="well span12 special">
                <small>People who worked on your tasks.</small>
            </div>
        </div>
        <mobbrtable entries="persons.result"
                    columns="[ 'gravatar-xsmall', 'username', 'roles', 'keywords', 'currency_iso', 'amount' ]"
                    has-search="true" has-header="true"></mobbrtable>
    </pane>
    <pane heading="Invoicing">
        <div class="row-fluid">
            <div class="well span12 special">
                <small>Your monthly invoices. We generate these on behalf of your crowdworkers.</small>
            </div>
        </div>

        <form name="invoicing" class="form-horizontal">

            <div class="control-group">
                <div class="control-label">
                    <label for="customer-name">Customer name</label>
                </div>

                <div class="controls">
                    <input ng-model="invoice.customer_name" name="customer_name" type="text" id="customer-name" placeholder="e.g. Google">
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <label for="customer-name">Customer address</label>
                </div>

                <div class="controls">
                    <input ng-model="invoice.customer_address" name="customer_address" type="text" id="customer-address" placeholder="e.g. Sesame Street, Manhattan">
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <label for="customer-country">Customer country</label>
                </div>

                <div class="controls">
                    <select id="customer-country" name="customer_country" ng-model="invoice.customer_country"
                            ng-options="value as key for (value, key) in countriesMap">
                        <option value="">No country</option>
                    </select>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <label for="customer-vat-number">Customer VAT-number</label>
                </div>

                <div class="controls">
                    <input ng-model="invoice.customer_vat_number" name="customer_vat_number" type="text" id="customer-vat-number" placeholder="e.g. NL001234567B01">
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <label for="customer-vat-rate">Customer VAT-rate (%)</label>
                </div>

                <div class="controls">
                    <input ng-model="invoice.customer_vat_rate" name="customer_vat_rate" type="text" id="customer-vat-rate" placeholder="e.g. 21">
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <label for="customer-status">Customer status</label>
                </div>

                <div class="controls">
                    <select ng-model="invoice.customer_status" name="customer_status" type="text" id="customer-status">
                        <option value="private">Private</option>
                        <option value="enterprise">Enterprise</option>
                    </select>
                </div>
            </div>
        </form>

        <invoicetable data="sourcing" action="'monthly'" button-text="'Request invoices'" button-action="requestInvoices"></invoicetable>
        <invoicetable data="sourcing" action="'requested'" button-text="'Cancel request'" button-action="cancelInvoices"></invoicetable>
        <invoicetable data="sourcing" action="'reviewed'" button-text="'Download invoice'"></invoicetable>
    </pane>
</tabs>

