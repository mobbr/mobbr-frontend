<div class="row top-bar">
    <div class="container">
        <div class="row left-pad">
            <div class="col-md-12">
                <h1>
                    Payment receipt
                    <span ng-if="payment.paiddatetime" ng-bind="payment.paiddatetime | amDateFormat : 'YYYYMMDD HH:MM'"></span>
                    <span ng-if="!payment.paiddatetime && payment.faileddatetime" ng-bind="payment.faileddatetime | amDateFormat : 'YYYYMMDD HH:MM'"></span>
                    <span ng-if="payment.faileddatetime && payment.service_message" ng-bind="payment.service_message"></span>

                    <div class="col-md-3 pull-right">
                        <a ng-show="payment.uri"
                           ng-href="#{{ $state.href('box.task.view', { task: encodeTask(payment.uri) }) }}"
                           class="btn btn-call white btn-block">Go to task</a>
                    </div>
                </h1>
            </div>
        </div>
    </div>
</div>

<div class="row top-info">
    <div class="container">
        <div class="row">
            <div class="row cards-wrapper">
                <div class="card-container col-xs-6 col-sm-3">
                    <div class="card fixed">
                        <div class="front">
                            <div class="row">
                                <small class="col-md-12">Amount</small>
                            </div>
                            <div class="row">
                                <span class="txt big col-md-12" ng-bind="payment.amount | mobbrcurrency"></span>
                            </div>
                            <div class="row">
                                <span class="txt big col-md-12" ng-bind="payment.currency_iso"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-container col-xs-6 col-sm-3">
                    <div class="card fixed">
                        <div class="front">
                            <div class="row">
                                <small class="col-md-12">#recipients / #unclaimed</small>
                            </div>
                            <div class="row">
                                <span class="txt big col-md-12" ng-bind="payment.receivers.length + ' / ' + (payment.receivers | filter : {unclaimed:'1'}).length"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-container col-xs-6 col-sm-3">
                    <div class="card fixed">
                        <div class="front">
                            <div class="row">
                                <small class="col-md-12">
                                    Invoiced </small>
                            </div>
                            <div class="row">
                                <span class="txt col-md-12">
                                    <i ng-show="payment.invoiced == '1'" class="mobbricon mobbricon-completed"></i>
                                    <span ng-bind="payment.invoiced == '1'?'Payment is invoiced':'Payment is not invoiced'"></span>
                                   </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-container col-xs-6 col-sm-3">
                    <div class="card fixed">
                        <div class="front">
                            <div class="row">
                                <small class="col-md-12">Date</small>
                            </div>
                            <div class="row">
                                <span class="txt big col-md-12" ng-bind="payment.paiddatetime | amDateFormat : 'MM/DD/YYYY'"></span>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>


<div class="row">
    <div class="container">
        <div class="row">
            <div class="md-12">
                <span ng-bind-html="payment.amount | mobbrcurrency:payment.currency_iso:true:true"></span>
            </div>
        </div>
    </div>
</div>

<div class="row" ng-if="payment.note">
    <div class="container">
        <div class="row">
            <div class="md-12">
                <span ng-bind="payment.note"></span>
            </div>
        </div>
    </div>
</div>

<div class="row" ng-if="payment.description">
    <div class="container">
        <div class="row">
            <div class="md-12">
                <span ng-bind="payment.description"></span>
            </div>
        </div>
    </div>
</div>



<accordion state-accordion="payment" ng-if="recieversAndSenders && recieversAndSenders.length > 0">
    <accordion-group is-open="stateAccordion['payment.persons']" is-disabled="true">
        <accordion-heading>
            <div class="container">
                <div class="row no-pad">
                    <div class="col-xs-10 title" ng-click="$state.is('payment.persons') ? $state.go('^') : $state.go('payment.persons')">
                        <span class="mobbricon mobbricon-unclaimed"></span>
                        <strong>Persons</strong>
                    </div>
                    <div class="icons">
                        <div class="col-xs-1 text-center icon">
                            <span class="mobbricon mobbricon-info"></span>
                        </div>
                        <div class="col-xs-1 text-center icon" ng-click="$state.is('payment.persons') ? $state.go('^') : $state.go('payment.persons')">
                            <span ng-class="$state.is('payment.persons') ? 'mobbricon-softclose' : 'mobbricon-addopen'" class="mobbricon"></span>
                        </div>
                    </div>
                </div>
            </div>
        </accordion-heading>
        <div class="container">
            <div class="row">
                <div ng-if="recieversAndSenders && recieversAndSenders.length > 0">
                    <div class="row" ng-if="(recieversAndSenders | filter:{selected:true}).length > 0">
                        <button class="btn btn-primary" ng-click="download()">Download invoice(s) selected</button>
                    </div>

                    <table class="table">
                        <thead>
                        <tr>
                            <th><input type="checkbox" ng-model="selectAll.selected" ng-if="payment.invoiced == '1'"></th>
                            <th ng-click="sortBy='username'; reverse=!reverse">Participant</th>
                            <th ng-click="sortBy='role'; reverse=!reverse">Role</th>
                            <th ng-click="sortBy='share'; reverse=!reverse">%</th>
                            <th ng-click="sortBy='currency_iso'; reverse=!reverse">Currency</th>
                            <th ng-click="sortBy='amount'; reverse=!reverse">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="participant in recieversAndSenders | orderBy:sortBy:reverse">
                            <td><input ng-if="payment.invoiced == '1' && participant.share_id" type="checkbox" ng-model="participant.selected"></td>
                            <td><img
                                    ng-src="https://secure.gravatar.com/avatar/{{ participant.gravatar }}?s=50&default=https://mobbr.com/img/default-gravatar.png"
                                    class="gravatar img-rounded"
                                    width="50"
                                    height="50">
                                {{participant.username}}
                            </td>
                            <td ng-bind="participant.role"></td>
                            <td ng-bind="participant.share|number:2"></td>
                            <td ng-bind="participant.currency_iso"></td>
                            <td ng-bind-html="participant.amount | mobbrcurrency:'':true:true"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </accordion-group>
</accordion>